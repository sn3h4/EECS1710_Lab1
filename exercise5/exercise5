import ddf.minim.*;
import ddf.minim.analysis.*;

Minim minim;
AudioInput in;
FFT fft;
int bufferSize = 512;
int band = 0;
float amp = 0;
float freq = 0;

void setupMinim() {
  minim = new Minim(this);
  in = minim.getLineIn(Minim.STEREO, bufferSize);
  fft = new FFT(in.bufferSize(), in.sampleRate());
}

void stopMinim() {
  in.close();
  minim.stop();
}

void updateMinim() {
  fft.forward(in.mix);

  amp = getAmp();
  
  freq = getFreq();
}

float getFreq() {
  band = 0;
  
  
  for(int i = 0; i < fft.specSize(); i++) {   
    if (fft.getBand(i) > fft.getBand(band)) band = i;
  }
  
 
  return band * 0.5 * (float) in.sampleRate() / (float) fft.specSize();
}

float getAmp() {
  return in.mix.level();
}
